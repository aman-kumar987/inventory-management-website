<div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
    <div>
        <h1 class="text-2xl font-bold text-gray-800">
            <%= title %>
        </h1>
        <p class="text-sm text-gray-500">A real-time summary of net available stock for each item.</p>
    </div>
    <div class="flex items-center gap-x-3 w-full md:w-auto">
        <div class="flex-grow">
            <select id="view-selector" class="form-input !py-2">
                <option value="summary" selected>Consolidated Stock</option>
                <option value="ledger">Transaction Ledger</option>
            </select>
        </div>
        <% if (user.role === 'SUPER_ADMIN' || user.role === 'CLUSTER_MANAGER') { %>
            <a id="export-btn" href="/inventory/summary/export" class="btn-secondary flex-shrink-0">
                <i class="fas fa-file-excel mr-2"></i>Export
            </a>
        <% } %>
        <% if (user.role !== 'VIEWER') { %>
            <a href="/inventory/new" class="btn-primary flex-shrink-0">Add Stock</a>
        <% } %>
    </div>
</div>

<%# Purane filter panel ko is naye, simple search bar se replace kiya gaya hai %>
<div class="mb-4 bg-white p-4 rounded-lg shadow-sm border">
    <form action="/inventory/summary" method="GET" class="flex items-center gap-2">
        <div class="relative flex-grow">
             <input type="text" name="search" placeholder="Search by Plant, Item Code, or Description..."
                   value="<%= filters.search || '' %>" class="form-input w-full">
        </div>
        <button type="submit" class="btn-primary flex-shrink-0">Search</button>
        <a href="/inventory/summary" class="btn-secondary flex-shrink-0">Clear</a>
    </form>
</div>

<div class="overflow-x-auto bg-white rounded-md shadow-sm">
    <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
            <tr>
                <th class="table-header w-1/5">Plant</th>
                <th class="table-header w-2/5">Item</th>
                <th class="table-header text-center w-24">Total New</th>
                <th class="table-header text-center w-24">Total Old</th>
                <%# "Total Scrap" column yahan se hata diya gaya hai %>
                <th class="table-header text-center w-24">Consumed (Net)</th>
                <th class="table-header text-center w-28 font-bold">Net Available</th>
            </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
            <% if (data.length > 0) { %>
                <% data.forEach(record => { %>
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 text-sm font-medium text-gray-800">
                            <%= record.plant %>
                        </td>
                        <td class="px-6 py-4 text-sm">
                            <div class="font-medium text-gray-900">
                                <%= record.itemCode %>
                            </div>
                            <div class="text-gray-500 max-w-xs truncate" title="<%= record.itemDescription %>">
                                <%= record.itemDescription || '-' %>
                            </div>
                            <div class="text-xs text-gray-400">Group: <%= record.itemGroup %></div>
                        </td>
                        <td class="px-6 py-4 text-center text-sm text-green-600 font-semibold">
                            <%= record.newQty %>
                        </td>
                        <td class="px-6 py-4 text-center text-sm text-blue-600 font-semibold">
                            <%= record.oldUsedQty %>
                        </td>
                        <%# "Total Scrap" data cell yahan se hata diya gaya hai %>
                        <td class="px-6 py-4 text-center text-sm text-red-600 font-semibold">
                            <%= record.consumed %>
                        </td>
                        <td class="px-6 py-4 text-center text-base font-bold text-gray-900">
                            <%= record.netAvailable %>
                        </td>
                    </tr>
                <% }) %>
            <% } else { %>
                <tr>
                    <%# Colspan 7 se 6 kar diya gaya hai %>
                    <td colspan="6" class="px-6 py-4 text-center text-gray-500">No stock found for the selected criteria.</td>
                </tr>
            <% } %>
        </tbody>
    </table>
</div>

<%- include('../partials/pagination', { currentPage, totalPages, baseUrl: '/inventory/summary' , ...filters }) %>
<script src="/js/view-switcher-script.js"></script>
<script src="/js/filter-toggle.js"></script>
<script src="/js/export-btn-summary.js"></script>